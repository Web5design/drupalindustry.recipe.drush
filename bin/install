#!/usr/bin/env bash

# Deploy the distribution.
# Should be a sub-command like bin/distribution install

# Initialize working directory variable
DISTRIBUTION_BASE_DIR="$(dirname $(readlink -f ${BASH_SOURCE[0]}))"
DISTRIBUTION_BASE_DIR="$(dirname $DISTRIBUTION_BASE_DIR)"

PREVIOUS_PWD=$(pwd)

cd $DISTRIBUTION_BASE_DIR

# Prevent multiple installations
PROJECT_INSTALLED=0
if [[ -f www/sites/default/settings.php ]]
then
    PROJECT_INSTALLED=1
fi

cd www

# Read distribution configuration file(s)

# Create DB
echo "What is the database URL? (example: mysql://user:password@localhost/sd). Create one if necessary. "
read DB_URL
if [[ $DB_URL == "" ]]
then
    echo "Aborting: no database information provided."
fi

# Additional settings
echo "What is the site administrator email address? "
read ADMIN_MAIL

# Install site
../bin/drush site-install simplydrupal --db-url=$DB_URL --account-name=admin --account-pass=admin --account-mail=$ADMIN_MAIL --site-name="Simply Drupal" --site-mail=$ADMIN_MAIL
cd ..

cd $PREVIOUS_PWD
