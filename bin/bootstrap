#!/usr/bin/env bash

###############################################################################
# Initialize working directory

# Initialize working directory variable
BASE_DIR="$(dirname $(readlink -f ${BASH_SOURCE[0]}))"
BASE_DIR="$(dirname $BASE_DIR)"

PREVIOUS_PWD=$(pwd)
cd $BASE_DIR

###############################################################################
# Check requirements
echo "Checking requirements"
requirements_ok=1
missing_requirements="\n"
for app in wget tar php5 patch curl
do
    installed=`which $app`
    if [[ ! -x $installed ]]
    then
        echo "* ERROR: $app"
        requirements_ok=0
    else
        echo "* OK:    $app"
    fi
done
if [[ $requirements_ok != 1 ]]
then
    echo "Error: cannot continue due to missing requirements. See log above."
    exit 1
fi
echo "Ok"

###############################################################################
# Initialize distribution directory structure
echo "Creating directories"
for directory in 'lib' 'var/tmp' 'var/log'
do
    if [[ ! -d directory ]]
    then
        mkdir -p $directory && echo "* $BASE_DIR/$directory"
    fi
done
echo "Done"

###############################################################################
# Drush and drush_make
$BASE_DIR/bin/drush_generator

###############################################################################

cd $PREVIOUS_PWD
